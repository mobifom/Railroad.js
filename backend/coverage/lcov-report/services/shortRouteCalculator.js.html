<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for services/shortRouteCalculator.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\prettify.css" />
    <link rel="stylesheet" href="..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\index.html">All files</a> / <a href="index.html">services</a> shortRouteCalculator.js
    </h1>
    <div class='clearfix'>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</td><td class="line-coverage quiet"><span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-yes">18x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">const logger = require("../utils/logger");
&nbsp;
/**
 * Class representing a Short Route Calculator for a graph.
 */
class ShortRouteCalculator {
&nbsp;
  /**
  * Creates an instance of ShortRouteCalculator.
  * @param {Object} graph - The graph object which contains the nodes and edges.
  */
  constructor(graph) {
    this.graph = graph;
    logger.info("ShortRouteCalculator initialized");
  }
&nbsp;
  /**
    * Calculates the shortest route from start to end.
    * @param {string} start - The starting node.
    * @param {string} end - The destination node.
    * @returns {(number|string)} The shortest distance or an error message if no route exists.
    */
  getShortestRoute(start, end) {
    try {
      if (!start || !end) {
        throw new Error("Invalid start or end point");
      }
      logger.info(`Calculating shortest route from ${start} to ${end}`);
      const { distances, checkedNodes, priorityQueue } =
        this.initializeShortestRouteSearch(start);
&nbsp;
      while (priorityQueue.length &gt; 0) {
        const { node: currentNode, distance: currentDistance } =
          priorityQueue.pop();
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (this.shouldSkipNode(checkedNodes, currentNode, end)) <span class="cstat-no" title="statement not covered" >continue;</span>
        checkedNodes.add(currentNode);
&nbsp;
        this.updateDistance(distances, currentNode, currentDistance);
&nbsp;
        if (this.isEndNodeReached(currentNode, start, end, currentDistance)) {
          logger.info(`Shortest route distance: ${currentDistance}`);
          return currentDistance;
        }
&nbsp;
        this.addNeighborsToPriorityQueue(
          currentNode,
          currentDistance,
          priorityQueue,
          checkedNodes,
          end
        );
      }
&nbsp;
      throw new Error("NO SUCH ROUTE");
    } catch (error) {
      logger.error(error.message);
      return error.message;
    }
  }
&nbsp;
  /**
    * Initializes the search for the shortest route.
    * @param {string} start - The starting node.
    * @returns {Object} An object containing the distances map, checked nodes set, and priority queue.
    */
  initializeShortestRouteSearch(start) {
    const distances = new Map();
    const checkedNodes = new Set();
    const priorityQueue = [{ node: start, distance: 0 }];
    return { distances, checkedNodes, priorityQueue };
  }
&nbsp;
  /**
   * Determines if the current node should be skipped during the search.
   * @param {Set.&lt;string&gt;} checkedNodes - The set of already checked nodes.
   * @param {string} currentNode - The current node being visited.
   * @param {string} end - The destination node.
   * @returns {boolean} True if the node should be skipped, false otherwise.
   */
  shouldSkipNode(checkedNodes, currentNode, end) {
    return checkedNodes.has(currentNode) &amp;&amp; currentNode !== end;
  }
&nbsp;
  /**
   * Updates the distance of a node in the distances map.
   * @param {Map.&lt;string, number&gt;} distances - The map of distances from the start node.
   * @param {string} currentNode - The current node being visited.
   * @param {number} currentDistance - The current distance from the start node.
   */
  updateDistance(distances, currentNode, currentDistance) {
    if (
      !distances.has(currentNode) ||
      currentDistance &lt; distances.get(currentNode)
    ) {
      distances.set(currentNode, currentDistance);
    }
  }
&nbsp;
  /**
   * Checks if the end node has been reached.
   * @param {string} currentNode - The current node being visited.
   * @param {string} start - The starting node.
   * @param {string} end - The destination node.
   * @param {number} currentDistance - The current distance from the start node.
   * @returns {boolean} True if the end node is reached, false otherwise.
   */
  isEndNodeReached(currentNode, start, end, currentDistance) {
    return (
      (currentNode === end &amp;&amp; currentNode !== start) ||
      (currentNode === start &amp;&amp; currentDistance !== 0)
    );
  }
&nbsp;
  /**
  * Adds the neighbors of the current node to the priority queue.
  * @param {string} currentNode - The current node being visited.
  * @param {number} currentDistance - The current distance from the start node.
  * @param {Array.&lt;Object&gt;} priorityQueue - The priority queue of nodes to be visited.
  * @param {Set.&lt;string&gt;} checkedNodes - The set of already checked nodes.
  * @param {string} end - The destination node.
  */
  addNeighborsToPriorityQueue(
    currentNode,
    currentDistance,
    priorityQueue,
    checkedNodes,
    end
  ) {
    this.graph.getNeighbors(currentNode).forEach((neighbor) =&gt; {
      if (!checkedNodes.has(neighbor.node) || neighbor.node === end) {
        priorityQueue.push({
          node: neighbor.node,
          distance: currentDistance + neighbor.weight,
        });
      }
    });
    priorityQueue.sort((a, b) =&gt; b.distance - a.distance);
  }
}
&nbsp;
module.exports = ShortRouteCalculator;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Jan 27 2025 09:21:05 GMT+1300 (New Zealand Daylight Time)
</div>
</div>
<script src="..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\sorter.js"></script>
</body>
</html>
